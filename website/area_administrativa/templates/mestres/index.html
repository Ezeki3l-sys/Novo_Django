{% extends "base.html" %}
{% load static %}




<script src="../js/menu.js">  </script>
<script src="../js/tema.js"></script>  
<script>
    let campanhas = JSON.parse(localStorage.getItem("campanhas"));
    for (let i = 0; i < campanhas.length; i++) {
    adicionarElementoCampanha(campanhas[i],i);
    
}

function adicionarElementoCampanha(campanha, pos) {      
    const container = document.getElementById("campanhas");
    const sectionCampanha = document.createElement("section");         
    sectionCampanha.setAttribute("id", `campanha-${pos}`);            
    sectionCampanha.classList.add("campanha", "caixa_da_campanha");

    // Adicionar conteúdo à campanha
    sectionCampanha.innerHTML = `<a onclick="abrirCampanha(${pos})" href="#">
        <h3>${campanha.nome}</h3>
        <p>${campanha.descricao}</p></a>
        <button type="button" class="btn btn-primary botao_criar_personagem" onclick="editarCampanha(${pos})" >Editar</button>        
    `;
    
    // Adicionar o novo elemento ao container
    container.appendChild(sectionCampanha);
    

}


</script>

<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.min.js" integrity="sha384-RuyvpeZCxMJCqVUGFI0Do1mQrods/hhxYlcVfGPOfQtPJh0JCw12tUAZ/Mv10S7D" crossorigin="anonymous"></script>



<script>
    //const modalEditar = document.getElementById('modalEditarCampanha');
    const modalEditar = new bootstrap.Modal(document.getElementById('modalEditarCampanha'));
    const salvarAlteracoesBtn = document.getElementById('salvarAlteracoes');

    function editarCampanha(idCampanha){
        let campanha = campanhas[idCampanha];
        // Exibe o ID da campanha na modal (você pode substituir por outros dados)
        document.getElementById('campanhaId').textContent = idCampanha;
    
      
        document.getElementById('nomeEditar').value = campanha.nome;
        document.getElementById('descricaoEditar').value = campanha.descricao;
        document.getElementById('dataInicioEditar').value = campanha.inicio;
        document.getElementById('dataFimEditar').value = campanha.fim
        document.getElementById('imagemEditar').value = campanha.img
        


        // Exibe a modal
        modalEditar.show();               
        // Passa o idCampanha para o botão salvar
        salvarAlteracoesBtn.onclick = function() {
                    // Pega os dados do formulário
                    const nome = document.getElementById('nomeEditar').value;
                    const descricao = document.getElementById('descricaoEditar').value;
                    const inicio = document.getElementById('dataInicioEditar').value;
                    const fim = document.getElementById('dataFimEditar').value
                    const img = document.getElementById('imagemEditar').value
                    

                    // Atualiza os dados da campanha no array de campanhas
                    campanha.nome = nome;
                    campanha.descricao = descricao;
                    campanha.inicio = inicio;
                    campanha.fim = fim;
                    campanha.img = img

                    // Atualiza o localStorage com as campanhas modificadas
                    const index = campanhas.findIndex(c => c.id === idCampanha);
                    campanhas[index] = campanha; // Substitui a campanha antiga pela nova

                    localStorage.setItem('campanhas', JSON.stringify(campanhas));

                    // Fecha a modal
                    modalEditar.hide();

                    // Exibe uma mensagem de sucesso ou algo similar
                    alert("Campanha atualizada com sucesso!");
                    location.reload();
                };

    }
    function abrirCampanha(idCampanha){
        let campanha = campanhas[idCampanha];
        localStorage.setItem('campanha_selecionada', JSON.stringify(campanha));
        window.location.href = "./detalhes.html";
        

    }
</script>